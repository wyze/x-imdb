<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <x-imdb></x-imdb>

@element x-imdb
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://wyze.github.io/x-imdb
-->
<polymer-element name="x-imdb" attributes="imdbid">

  <template>

    <link rel="stylesheet" href="x-imdb.css" />

    <content></content>

    <core-ajax handleAs="json" response="{{resp}}" url="http://omdbapi.com/" on-core-response="{{parseMovie}}"></core-ajax>

    <section></section>

  </template>

  <script>

    Polymer('x-imdb', {
      /**
       * The `noevent` event is not actually fired from here,
       * we document it as an example of documenting events.
       *
       * @event noevent
       */

      /**
       * The `imdbid` attribute does not yet have a purpose.
       *
       * @attribute imdbid
       * @type string
       */
      imdbid: '',

      /**
       * The `aProp` is a property that does something cool.
       *
       * @property aProp
       * @type bool
       */
      aProp: false,

      ready: function() {
        this.ajax = this.q('core-ajax');

        // validate our required property
        if ( !/^t{2}?\d{7}$/.test(this.imdbid) ) {
          throw 'Please provide a proper IMDB ID.';
        }

        this.ajax.params = { "i": this.imdbid.replace(/^([^tt])/, 'tt$1') };
        this.ajax.go();
      },

      /**
       * The `parseMovie` method will parse the response from OMDB API.
       *
       * @method parseMovie
       * @return {Object} Returns undefined.
       * @param {Object} e Event object for the core-ajax element.
       * @param {Object} request Object containing the response and XHR.
       */
      parseMovie: function( e, request ) {
        var movie   = request.response,
            section = this.q('section');

        for( var prop in movie ) {
          var container = this.c('div'),
              label     = this.c('label'),
              span      = this.c('span');

          label.innerHTML = prop;
          span.innerHTML = movie[prop];

          container.appendChild(label);
          container.appendChild(span);
          section.appendChild(container);
        }
      },

      /**
       * The `q` method is a shortcut for document.querySelector.
       *
       * @method q
       * @return {Object} Returns DOMNode.
       * @param {String} selector A valid CSS3 selector.
       */
      q: function( selector ) {
        return this.shadowRoot.querySelector(selector);
      },

      /**
       * The `c` method is a shortcut to create a dom node.
       *
       * @method c
       * @return {Object} Returns DOMNode.
       * @param {String} element TagName of the element to create.
       */
      c: function( element ) {
        return document.createElement(element);
      },

      /**
       * The `task` method does no work at this time.
       *
       * @method task
       * @return {Object} Returns undefined.
       * @param {String} dummy Serves no purpose today.
       */
      task: function(dummy) {
      }

    });

  </script>

</polymer-element>
